<link rel="stylesheet" href="/style/css/admin.css">

<div class="admin-wrap">
  <h1 class="page-title">Manage Backlog</h1>

  <div style="text-align:center; margin-bottom:1.5rem;">
    <a href="/admin" class="btn">← Back to Main Admin</a>
  </div>

  <p class="muted">
    Add or remove games from your backlog.
    (These changes will update the <code>backlog</code> table in your SQLite database.)
  </p>

  <section class="admin-grid">
    {{!-- ADD FORM --}}
    <form class="card add-form" method="POST" action="/admin/backlog/save">
      <h2>Add New Game</h2>

      <label for="bl_name">Game Name</label>
      <input
        type="text"
        id="bl_name"
        name="name"
        placeholder="e.g., Hollow Knight"
        required
      >

      <label for="bl_source">Source / Platform</label>
      <input
        type="text"
        id="bl_source"
        name="source"
        placeholder="Steam / PSN / Switch / SNES / Epic..."
      >

      <button type="submit" class="btn btn-primary">Add to Backlog</button>
    </form>

    {{!-- LIVE PREVIEW --}}
    <aside class="card preview-card">
      <h2>Preview</h2>
      <p id="pv_bl_name" class="preview-text">Game name…</p>
      <p id="pv_bl_source" class="muted">Source: —</p>
    </aside>
  </section>

  {{!-- EXISTING BACKLOG --}}
  <section class="card backlog-list">
    <h2>Current Backlog ({{items.length}})</h2>

    {{#if items.length}}
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 5rem;">ID</th>
            <th>Game Title</th>
            <th style="width: 10rem;">Source</th>
            <th style="width: 8rem;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {{#each items}}
            <tr>
              <td>{{this.id}}</td>
              <td>{{this.name}}</td>
              <td>{{#if this.source}}{{this.source}}{{else}}—{{/if}}</td>
              <td>
                <form
                  method="POST"
                  action="/admin/backlog/delete"
                  onsubmit="return confirm('Remove {{this.name}} from backlog?');"
                >
                  <input type="hidden" name="id" value="{{this.id}}">
                  <button type="submit" class="btn btn-danger">Delete</button>
                </form>
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <p class="muted">Your backlog is currently empty.</p>
    {{/if}}
  </section>

  {{!-- BEATEN GAMES (ALL YEARS) --}}
<section class="card backlog-list" style="margin-top: 2rem;">
  <h2>All Beaten Games ({{beatenGames.length}})</h2>

  {{#if beatenGames.length}}
    <table class="admin-table">
      <thead>
        <tr>
          <th>Game Title</th>
          <th style="width: 7rem;">Year</th>
        </tr>
      </thead>
      <tbody>
        {{#each beatenGames}}
          <tr>
            <td>{{this.name}}</td>
            <td>{{this.year}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p class="muted">No beaten games found in challenge tables.</p>
  {{/if}}
</section>



</div>

<script>
  (function () {
    const nameInput = document.getElementById('bl_name');
    const sourceInput = document.getElementById('bl_source');
    const pvName = document.getElementById('pv_bl_name');
    const pvSource = document.getElementById('pv_bl_source');

    function updatePreview() {
      const nameVal = (nameInput.value || '').trim();
      const sourceVal = (sourceInput.value || '').trim();

      pvName.textContent = nameVal || 'Game name…';
      pvSource.textContent = sourceVal ? 'Source: ' + sourceVal : 'Source: —';
    }

    nameInput.addEventListener('input', updatePreview);
    sourceInput.addEventListener('input', updatePreview);
    updatePreview();
  })();
</script>
